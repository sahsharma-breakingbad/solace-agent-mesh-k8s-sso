apiVersion: apps/v1
kind: Deployment
metadata:
  name: solace-agent-mesh-deployment
  namespace: sam-infra
  labels:
    app: solace-agent-mesh
spec:
  replicas: 1
  selector:
    matchLabels:
      app: solace-agent-mesh
  template:
    metadata:
      labels:
        app: solace-agent-mesh
    spec:
      containers:
      - name: solace-agent-mesh
        image: solace/solace-agent-mesh:latest
        ports: 
          - containerPort: 8000
        # Set the working directory to /app
        workingDir: /app
        # The command to start the application
        command: ["solace-agent-mesh", "run"]
        # The arguments now include the 'configs/' path prefix
        args:
        - "configs/main_orchestrator.yaml"
        - "configs/oauth2_server.yaml"
        - "configs/oauth2_config.yaml"
        - "configs/webui.yaml"
        envFrom:
        - secretRef:
            name: solace-agent-mesh-secret
        volumeMounts:
        - name: config-volume
          # Mount the ConfigMap to /app/configs
          mountPath: /app/configs
      volumes:
      - name: config-volume
        configMap:
          name: solace-agent-mesh-config